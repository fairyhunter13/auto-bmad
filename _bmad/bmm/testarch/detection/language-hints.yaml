# Language Detection Hints for TEA (Test Architect)
#
# IMPORTANT: This file contains DETECTION METADATA only - NOT code templates or API details.
# TEA uses this ONLY to identify languages/frameworks in a project.
#
# ============================================================================
# MANDATORY REAL-TIME WEB FETCHING
# ============================================================================
# After detection, TEA MUST fetch latest documentation from the internet
# using the CURRENT timestamp (NOW()). Never rely on cached or memorized data.
#
# Fetch Strategy:
#   1. Detect language/framework using hints below
#   2. Web fetch: "[framework] official documentation" with current date
#   3. Web fetch: "[framework] [current_year] best practices"
#   4. Web fetch: "[framework] latest version changelog"
#   5. Generate code using ONLY freshly fetched information
#   6. Include fetch timestamp in generated code comments
#
# Why Real-Time Fetching:
#   - Framework APIs change frequently
#   - Best practices evolve
#   - Static templates become outdated within months
#   - Documentation URLs may change
#   - New frameworks emerge constantly
#
# ============================================================================
# FILE STRUCTURE
# ============================================================================
# Structure:
#   - detect_by: How to identify this language in a project (STABLE)
#   - test_frameworks: Framework names and detection patterns (STABLE)
#   - docs: Starting point URLs (MAY CHANGE - always verify via web search)
#
# For languages not listed here, TEA will:
#   1. Attempt detection from file extensions
#   2. Web search for "[language] testing framework [current_year]"
#   3. Web search for "[language] official documentation"
#   4. Ask user for guidance if uncertain
# ============================================================================

# =============================================================================
# TIER 1: Most Common Languages (~85% of projects)
# =============================================================================

typescript:
  detect_by:
    files: ["tsconfig.json", "tsconfig.*.json"]
    extensions: [".ts", ".tsx", ".mts", ".cts"]
    package_indicators:
      file: "package.json"
      fields: ["devDependencies.typescript", "dependencies.typescript"]
  test_frameworks:
    - name: playwright
      detect: "@playwright/test"
      docs: "https://playwright.dev/docs/intro" # Verified 2026-01-23
      docs_alt: "https://playwright.dev/docs/writing-tests"
      test_patterns: ["*.spec.ts", "*.test.ts"]
      notes: "Requires Node.js 20.x, 22.x, or 24.x. Supports TS, JS, Python, C#, Java."
    - name: vitest
      detect: "vitest"
      docs: "https://vitest.dev/guide/" # Verified 2026-01-23 - v4.0.17
      docs_alt: "https://vitest.dev/api/"
      test_patterns: ["*.test.ts", "*.spec.ts"]
      notes: "Requires Vite >=6.0.0 and Node >=20.0.0. Jest-compatible API."
    - name: jest
      detect: "jest"
      docs: "https://jestjs.io/docs/getting-started" # Verified 2026-01-23 - v30.0
      docs_alt: "https://jestjs.io/docs/api"
      test_patterns: ["*.test.ts", "*.spec.ts", "__tests__/*.ts"]
      notes: "v30.0 current. Use @jest/globals for TypeScript types."
    - name: cypress
      detect: "cypress"
      docs: "https://docs.cypress.io/app/get-started/why-cypress" # Verified 2026-01-23
      docs_alt: "https://docs.cypress.io/api/table-of-contents"
      test_patterns: ["*.cy.ts", "cypress/e2e/*.ts"]
      notes: "E2E and Component testing. Includes cy.prompt() for AI-assisted tests."
    - name: mocha
      detect: "mocha"
      docs: "https://mochajs.org/"
      test_patterns: ["*.test.ts", "*.spec.ts", "test/*.ts"]

javascript:
  detect_by:
    files: ["package.json", "jsconfig.json"]
    extensions: [".js", ".jsx", ".mjs", ".cjs"]
    exclude_if: ["tsconfig.json"] # Prefer TypeScript if both exist
  test_frameworks:
    - name: playwright
      detect: "@playwright/test"
      docs: "https://playwright.dev/docs"
      test_patterns: ["*.spec.js", "*.test.js"]
    - name: jest
      detect: "jest"
      docs: "https://jestjs.io/docs/getting-started"
      test_patterns: ["*.test.js", "*.spec.js", "__tests__/*.js"]
    - name: vitest
      detect: "vitest"
      docs: "https://vitest.dev/guide/"
      test_patterns: ["*.test.js", "*.spec.js"]
    - name: cypress
      detect: "cypress"
      docs: "https://docs.cypress.io"
      test_patterns: ["*.cy.js", "cypress/e2e/*.js"]
    - name: mocha
      detect: "mocha"
      docs: "https://mochajs.org/"
      test_patterns: ["*.test.js", "*.spec.js"]

python:
  detect_by:
    files: ["requirements.txt", "pyproject.toml", "setup.py", "Pipfile", "poetry.lock"]
    extensions: [".py", ".pyi"]
  test_frameworks:
    - name: pytest
      detect: "pytest"
      docs: "https://docs.pytest.org/en/stable/" # Verified 2026-01-23
      docs_alt: "https://docs.pytest.org/en/stable/reference/reference.html"
      test_patterns: ["test_*.py", "*_test.py", "tests/*.py"]
      config_files: ["pytest.ini", "pyproject.toml", "conftest.py"]
      notes: "Python 3.10+ required. 1300+ external plugins available."
    - name: unittest
      detect: "unittest"
      docs: "https://docs.python.org/3/library/unittest.html"
      test_patterns: ["test_*.py", "*_test.py"]
      notes: "Built-in Python testing framework."
    - name: playwright-python
      detect: "playwright"
      docs: "https://playwright.dev/python/docs/intro" # Verified 2026-01-23
      test_patterns: ["test_*.py"]
      notes: "Use with pytest-playwright for best integration."
    - name: robot
      detect: "robotframework"
      docs: "https://robotframework.org/robotframework/"
      test_patterns: ["*.robot"]
    - name: behave
      detect: "behave"
      docs: "https://behave.readthedocs.io/"
      test_patterns: ["*.feature", "steps/*.py"]

java:
  detect_by:
    files: ["pom.xml", "build.gradle", "build.gradle.kts", "settings.gradle"]
    extensions: [".java"]
  test_frameworks:
    - name: junit6
      detect: "org.junit.jupiter"
      docs: "https://junit.org/junit5/docs/current/user-guide/" # Verified 2026-01-23 - JUnit 6.0.2
      docs_alt: "https://junit.org/junit5/docs/current/user-guide/overview.html"
      test_patterns: ["*Test.java", "*Tests.java", "src/test/java/**/*.java"]
      notes: "JUnit 6.0.2 current. Requires Java 17+. JUnit Platform + Jupiter + Vintage."
    - name: junit5
      detect: "org.junit.jupiter"
      docs: "https://junit.org/junit5/docs/5.14.2/user-guide/"
      test_patterns: ["*Test.java", "*Tests.java", "src/test/java/**/*.java"]
      notes: "Legacy - consider upgrading to JUnit 6.x"
    - name: junit4
      detect: "junit:junit"
      docs: "https://junit.org/junit4/"
      test_patterns: ["*Test.java", "*Tests.java"]
      notes: "Legacy - use JUnit Vintage for migration to JUnit 6."
    - name: testng
      detect: "org.testng"
      docs: "https://testng.org/doc/documentation-main.html"
      test_patterns: ["*Test.java", "*Tests.java"]
    - name: selenium
      detect: "org.seleniumhq.selenium"
      docs: "https://www.selenium.dev/documentation/"
      test_patterns: ["*Test.java"]
    - name: cucumber
      detect: "io.cucumber"
      docs: "https://cucumber.io/docs/cucumber/"
      test_patterns: ["*.feature", "*Steps.java"]

csharp:
  detect_by:
    files: ["*.csproj", "*.sln", "Directory.Build.props"]
    extensions: [".cs"]
  test_frameworks:
    - name: xunit
      detect: "xunit"
      docs: "https://xunit.net/docs/getting-started/netcore/cmdline"
      test_patterns: ["*Tests.cs", "*Test.cs"]
    - name: nunit
      detect: "NUnit"
      docs: "https://docs.nunit.org/"
      test_patterns: ["*Tests.cs", "*Test.cs"]
    - name: mstest
      detect: "Microsoft.VisualStudio.TestTools"
      docs: "https://docs.microsoft.com/en-us/dotnet/core/testing/unit-testing-with-mstest"
      test_patterns: ["*Tests.cs", "*Test.cs"]
    - name: playwright-dotnet
      detect: "Microsoft.Playwright"
      docs: "https://playwright.dev/dotnet/docs/intro"
      test_patterns: ["*Tests.cs"]
    - name: specflow
      detect: "SpecFlow"
      docs: "https://docs.specflow.org/"
      test_patterns: ["*.feature", "*Steps.cs"]

go:
  detect_by:
    files: ["go.mod", "go.sum"]
    extensions: [".go"]
  test_frameworks:
    - name: testing
      detect: "testing" # built-in
      docs: "https://pkg.go.dev/testing" # Verified 2026-01-23 - go1.25.6
      docs_alt: "https://go.dev/doc/tutorial/add-a-test"
      test_patterns: ["*_test.go"]
      notes: "Built-in. Use b.Loop() for benchmarks (added in go1.24). Supports fuzzing."
    - name: testify
      detect: "github.com/stretchr/testify"
      docs: "https://pkg.go.dev/github.com/stretchr/testify"
      test_patterns: ["*_test.go"]
      notes: "Popular assertion and mocking library."
    - name: ginkgo
      detect: "github.com/onsi/ginkgo"
      docs: "https://onsi.github.io/ginkgo/"
      test_patterns: ["*_test.go", "*_suite_test.go"]
      notes: "BDD-style testing framework."
    - name: goconvey
      detect: "github.com/smartystreets/goconvey"
      docs: "https://github.com/smartystreets/goconvey"
      test_patterns: ["*_test.go"]
    - name: testify
      detect: "github.com/stretchr/testify"
      docs: "https://pkg.go.dev/github.com/stretchr/testify"
      test_patterns: ["*_test.go"]
    - name: ginkgo
      detect: "github.com/onsi/ginkgo"
      docs: "https://onsi.github.io/ginkgo/"
      test_patterns: ["*_test.go", "*_suite_test.go"]
    - name: goconvey
      detect: "github.com/smartystreets/goconvey"
      docs: "https://github.com/smartystreets/goconvey"
      test_patterns: ["*_test.go"]

php:
  detect_by:
    files: ["composer.json", "composer.lock"]
    extensions: [".php"]
  test_frameworks:
    - name: phpunit
      detect: "phpunit/phpunit"
      docs: "https://phpunit.de/documentation.html"
      test_patterns: ["*Test.php", "tests/*.php"]
    - name: pest
      detect: "pestphp/pest"
      docs: "https://pestphp.com/docs"
      test_patterns: ["*Test.php", "tests/*.php"]
    - name: codeception
      detect: "codeception/codeception"
      docs: "https://codeception.com/docs"
      test_patterns: ["*Cest.php", "*Test.php"]
    - name: behat
      detect: "behat/behat"
      docs: "https://docs.behat.org/"
      test_patterns: ["*.feature", "*Context.php"]

ruby:
  detect_by:
    files: ["Gemfile", "Gemfile.lock", "*.gemspec"]
    extensions: [".rb"]
  test_frameworks:
    - name: rspec
      detect: "rspec"
      docs: "https://rspec.info/documentation/"
      test_patterns: ["*_spec.rb", "spec/**/*.rb"]
    - name: minitest
      detect: "minitest"
      docs: "https://docs.seattlerb.org/minitest/"
      test_patterns: ["*_test.rb", "test/**/*.rb"]
    - name: cucumber
      detect: "cucumber"
      docs: "https://cucumber.io/docs/cucumber/"
      test_patterns: ["*.feature", "*_steps.rb"]
    - name: capybara
      detect: "capybara"
      docs: "https://github.com/teamcapybara/capybara#readme"
      test_patterns: ["*_spec.rb"]

rust:
  detect_by:
    files: ["Cargo.toml", "Cargo.lock"]
    extensions: [".rs"]
  test_frameworks:
    - name: cargo-test
      detect: "cargo test" # built-in
      docs: "https://doc.rust-lang.org/book/ch11-00-testing.html"
      test_patterns: ["src/**/*.rs", "tests/*.rs"]
      notes: "Tests are typically in the same file as code (#[cfg(test)]) or in tests/ directory"
    - name: proptest
      detect: "proptest"
      docs: "https://proptest-rs.github.io/proptest/intro.html"
      test_patterns: ["*.rs"]
    - name: mockall
      detect: "mockall"
      docs: "https://docs.rs/mockall/latest/mockall/"
      test_patterns: ["*.rs"]

kotlin:
  detect_by:
    files: ["build.gradle.kts", "settings.gradle.kts"]
    extensions: [".kt", ".kts"]
    package_indicators:
      file: "build.gradle.kts"
      content: "kotlin("
  test_frameworks:
    - name: junit5
      detect: "org.junit.jupiter"
      docs: "https://junit.org/junit5/docs/current/user-guide/"
      test_patterns: ["*Test.kt", "*Tests.kt"]
    - name: kotest
      detect: "io.kotest"
      docs: "https://kotest.io/docs/framework/framework.html"
      test_patterns: ["*Test.kt", "*Spec.kt"]
    - name: mockk
      detect: "io.mockk"
      docs: "https://mockk.io/"
      test_patterns: ["*Test.kt"]

# =============================================================================
# TIER 2: Common Languages (~12% of projects)
# =============================================================================

swift:
  detect_by:
    files: ["Package.swift", "*.xcodeproj", "*.xcworkspace"]
    extensions: [".swift"]
  test_frameworks:
    - name: xctest
      detect: "XCTest"
      docs: "https://developer.apple.com/documentation/xctest"
      test_patterns: ["*Tests.swift", "*Test.swift"]
    - name: quick
      detect: "Quick"
      docs: "https://github.com/Quick/Quick"
      test_patterns: ["*Spec.swift"]

scala:
  detect_by:
    files: ["build.sbt", "build.sc"]
    extensions: [".scala", ".sc"]
  test_frameworks:
    - name: scalatest
      detect: "scalatest"
      docs: "https://www.scalatest.org/user_guide"
      test_patterns: ["*Spec.scala", "*Test.scala", "*Suite.scala"]
    - name: specs2
      detect: "specs2"
      docs: "https://etorreborre.github.io/specs2/"
      test_patterns: ["*Spec.scala"]
    - name: munit
      detect: "munit"
      docs: "https://scalameta.org/munit/"
      test_patterns: ["*Suite.scala", "*Test.scala"]

dart:
  detect_by:
    files: ["pubspec.yaml", "pubspec.lock"]
    extensions: [".dart"]
  test_frameworks:
    - name: flutter_test
      detect: "flutter_test"
      docs: "https://docs.flutter.dev/testing"
      test_patterns: ["*_test.dart", "test/**/*.dart"]
    - name: test
      detect: "test:"
      docs: "https://pub.dev/packages/test"
      test_patterns: ["*_test.dart"]
    - name: integration_test
      detect: "integration_test"
      docs: "https://docs.flutter.dev/testing/integration-tests"
      test_patterns: ["integration_test/**/*.dart"]

elixir:
  detect_by:
    files: ["mix.exs", "mix.lock"]
    extensions: [".ex", ".exs"]
  test_frameworks:
    - name: exunit
      detect: "ExUnit" # built-in
      docs: "https://hexdocs.pm/ex_unit/ExUnit.html"
      test_patterns: ["*_test.exs", "test/**/*.exs"]
    - name: wallaby
      detect: "wallaby"
      docs: "https://hexdocs.pm/wallaby/readme.html"
      test_patterns: ["*_test.exs"]

cpp:
  detect_by:
    files: ["CMakeLists.txt", "Makefile", "*.vcxproj", "meson.build", "conanfile.txt"]
    extensions: [".cpp", ".cc", ".cxx", ".hpp", ".h"]
  test_frameworks:
    - name: googletest
      detect: "gtest"
      docs: "https://google.github.io/googletest/"
      test_patterns: ["*_test.cpp", "*_test.cc", "test_*.cpp"]
    - name: catch2
      detect: "catch2"
      docs: "https://github.com/catchorg/Catch2/blob/devel/docs/Readme.md"
      test_patterns: ["*_test.cpp", "*Test.cpp"]
    - name: doctest
      detect: "doctest"
      docs: "https://github.com/doctest/doctest"
      test_patterns: ["*_test.cpp"]
    - name: ctest
      detect: "enable_testing()"
      docs: "https://cmake.org/cmake/help/latest/command/enable_testing.html"
      test_patterns: ["*_test.cpp"]

c:
  detect_by:
    files: ["CMakeLists.txt", "Makefile", "configure.ac"]
    extensions: [".c", ".h"]
    exclude_if: [".cpp", ".cc", ".hpp"] # Prefer C++ if both exist
  test_frameworks:
    - name: unity
      detect: "unity.h"
      docs: "https://github.com/ThrowTheSwitch/Unity"
      test_patterns: ["test_*.c", "*_test.c"]
    - name: cmocka
      detect: "cmocka.h"
      docs: "https://cmocka.org/"
      test_patterns: ["test_*.c"]
    - name: check
      detect: "check.h"
      docs: "https://libcheck.github.io/check/"
      test_patterns: ["check_*.c", "test_*.c"]

r:
  detect_by:
    files: ["DESCRIPTION", "NAMESPACE", "*.Rproj"]
    extensions: [".R", ".r", ".Rmd"]
  test_frameworks:
    - name: testthat
      detect: "testthat"
      docs: "https://testthat.r-lib.org/"
      test_patterns: ["test-*.R", "test_*.R", "tests/testthat/*.R"]
    - name: tinytest
      detect: "tinytest"
      docs: "https://github.com/markvanderloo/tinytest"
      test_patterns: ["test_*.R"]

perl:
  detect_by:
    files: ["cpanfile", "Makefile.PL", "Build.PL", "META.yml"]
    extensions: [".pl", ".pm", ".t"]
  test_frameworks:
    - name: test-more
      detect: "Test::More"
      docs: "https://metacpan.org/pod/Test::More"
      test_patterns: ["*.t", "t/*.t"]
    - name: test2
      detect: "Test2"
      docs: "https://metacpan.org/pod/Test2"
      test_patterns: ["*.t", "t/*.t"]

lua:
  detect_by:
    files: ["*.rockspec", ".luacheckrc"]
    extensions: [".lua"]
  test_frameworks:
    - name: busted
      detect: "busted"
      docs: "https://lunarmodules.github.io/busted/"
      test_patterns: ["*_spec.lua", "spec/**/*.lua"]
    - name: luaunit
      detect: "luaunit"
      docs: "https://github.com/bluebird75/luaunit"
      test_patterns: ["test_*.lua", "*_test.lua"]

haskell:
  detect_by:
    files: ["*.cabal", "stack.yaml", "cabal.project"]
    extensions: [".hs", ".lhs"]
  test_frameworks:
    - name: hspec
      detect: "hspec"
      docs: "https://hspec.github.io/"
      test_patterns: ["*Spec.hs", "test/**/*.hs"]
    - name: tasty
      detect: "tasty"
      docs: "https://hackage.haskell.org/package/tasty"
      test_patterns: ["*Test.hs", "test/**/*.hs"]
    - name: quickcheck
      detect: "QuickCheck"
      docs: "https://hackage.haskell.org/package/QuickCheck"
      test_patterns: ["*.hs"]

clojure:
  detect_by:
    files: ["project.clj", "deps.edn", "build.clj"]
    extensions: [".clj", ".cljs", ".cljc", ".edn"]
  test_frameworks:
    - name: clojure-test
      detect: "clojure.test" # built-in
      docs: "https://clojure.github.io/clojure/clojure.test-api.html"
      test_patterns: ["*_test.clj", "test/**/*.clj"]
    - name: midje
      detect: "midje"
      docs: "https://github.com/marick/Midje"
      test_patterns: ["*_test.clj"]
    - name: kaocha
      detect: "kaocha"
      docs: "https://github.com/lambdaisland/kaocha"
      test_patterns: ["*_test.clj"]

julia:
  detect_by:
    files: ["Project.toml", "Manifest.toml"]
    extensions: [".jl"]
  test_frameworks:
    - name: test
      detect: "Test" # built-in
      docs: "https://docs.julialang.org/en/v1/stdlib/Test/"
      test_patterns: ["test/*.jl", "test/runtests.jl"]

# =============================================================================
# TIER 3: Emerging/Niche Languages (~3% of projects)
# =============================================================================

zig:
  detect_by:
    files: ["build.zig", "build.zig.zon"]
    extensions: [".zig"]
  test_frameworks:
    - name: zig-test
      detect: "std.testing" # built-in
      docs: "https://ziglang.org/documentation/master/#Zig-Test"
      test_patterns: ["*.zig"]
      notes: "Tests are inline with code using test blocks"

nim:
  detect_by:
    files: ["*.nimble", "nim.cfg"]
    extensions: [".nim", ".nims"]
  test_frameworks:
    - name: unittest
      detect: "unittest" # built-in
      docs: "https://nim-lang.org/docs/unittest.html"
      test_patterns: ["test_*.nim", "t_*.nim", "tests/*.nim"]

crystal:
  detect_by:
    files: ["shard.yml", "shard.lock"]
    extensions: [".cr"]
  test_frameworks:
    - name: spec
      detect: "spec" # built-in
      docs: "https://crystal-lang.org/reference/guides/testing.html"
      test_patterns: ["*_spec.cr", "spec/**/*.cr"]

vlang:
  detect_by:
    files: ["v.mod"]
    extensions: [".v"]
  test_frameworks:
    - name: vtest
      detect: "v test" # built-in
      docs: "https://github.com/vlang/v/blob/master/doc/docs.md#testing"
      test_patterns: ["*_test.v"]

gleam:
  detect_by:
    files: ["gleam.toml"]
    extensions: [".gleam"]
  test_frameworks:
    - name: gleeunit
      detect: "gleeunit"
      docs: "https://hexdocs.pm/gleeunit/"
      test_patterns: ["*_test.gleam", "test/**/*.gleam"]

ocaml:
  detect_by:
    files: ["dune", "dune-project", "*.opam"]
    extensions: [".ml", ".mli"]
  test_frameworks:
    - name: alcotest
      detect: "alcotest"
      docs: "https://github.com/mirage/alcotest"
      test_patterns: ["test_*.ml", "test/*.ml"]
    - name: ounit
      detect: "ounit2"
      docs: "https://github.com/gildor478/ounit"
      test_patterns: ["test_*.ml"]

fsharp:
  detect_by:
    files: ["*.fsproj"]
    extensions: [".fs", ".fsx"]
  test_frameworks:
    - name: xunit
      detect: "xunit"
      docs: "https://xunit.net/"
      test_patterns: ["*Tests.fs", "*Test.fs"]
    - name: nunit
      detect: "NUnit"
      docs: "https://docs.nunit.org/"
      test_patterns: ["*Tests.fs"]
    - name: expecto
      detect: "Expecto"
      docs: "https://github.com/haf/expecto"
      test_patterns: ["*Tests.fs"]

groovy:
  detect_by:
    files: ["build.gradle"]
    extensions: [".groovy", ".gvy"]
    package_indicators:
      file: "build.gradle"
      content: "apply plugin: 'groovy'"
  test_frameworks:
    - name: spock
      detect: "spock"
      docs: "https://spockframework.org/spock/docs/"
      test_patterns: ["*Spec.groovy", "*Test.groovy"]
    - name: junit
      detect: "junit"
      docs: "https://junit.org/"
      test_patterns: ["*Test.groovy"]

# =============================================================================
# MONOREPO DETECTION PATTERNS
# =============================================================================
# TEA detects monorepo structures BEFORE language detection.
# Once detected, TEA scopes to a specific package and runs language detection within it.

_monorepo:
  description: |
    Monorepo detection runs as Step 0, BEFORE language detection.
    This ensures TEA correctly identifies the target package and uses
    package-specific dependencies rather than root-level ones.

  detection_patterns:
    # JavaScript/TypeScript Ecosystem
    lerna:
      detect_by:
        files: ["lerna.json"]
      package_locations: "lerna.json → packages field"
      common_paths: ["packages/*"]
      notes: "Legacy but still common. Check for lerna.json packages array."

    pnpm_workspaces:
      detect_by:
        files: ["pnpm-workspace.yaml"]
      package_locations: "pnpm-workspace.yaml → packages field"
      common_paths: ["packages/*", "apps/*"]
      notes: "Modern, fast package manager. Strict workspace isolation."

    turborepo:
      detect_by:
        files: ["turbo.json"]
      package_locations: "Check package.json workspaces or turbo.json pipeline"
      common_paths: ["apps/*", "packages/*"]
      notes: "Build system for JS/TS monorepos. Often combined with pnpm/npm workspaces."

    nx:
      detect_by:
        files: ["nx.json", "project.json"]
      package_locations: "project.json files in subdirectories"
      common_paths: ["apps/*", "libs/*", "packages/*"]
      notes: "Full-featured monorepo tool. Has built-in affected/changed detection."

    rush:
      detect_by:
        files: ["rush.json"]
      package_locations: "rush.json → projects array"
      common_paths: ["apps/*", "libraries/*", "tools/*"]
      notes: "Microsoft's monorepo manager. Uses shrinkwrap for consistency."

    npm_yarn_workspaces:
      detect_by:
        files: ["package.json"]
        content_pattern: '"workspaces"'
      package_locations: "package.json → workspaces field (array or object)"
      common_paths: ["packages/*", "apps/*", "@scope/*"]
      notes: "Native workspace support in npm (v7+) and yarn. Check for workspaces field."

    # Go Ecosystem
    go_multi_module:
      detect_by:
        pattern: "Multiple go.mod files in subdirectories"
      package_locations: "Each directory containing go.mod"
      common_paths: ["cmd/*", "pkg/*", "internal/*", "services/*"]
      notes: "Go workspaces (go.work) or independent modules. Check go.work for explicit workspace."

    go_workspace:
      detect_by:
        files: ["go.work"]
      package_locations: "go.work → use directives"
      common_paths: ["cmd/*", "services/*"]
      notes: "Go 1.18+ workspace feature. Explicit multi-module setup."

    # Rust Ecosystem
    rust_workspace:
      detect_by:
        files: ["Cargo.toml"]
        content_pattern: "[workspace]"
      package_locations: "Cargo.toml → workspace.members array"
      common_paths: ["crates/*", "packages/*", "libs/*"]
      notes: "Check root Cargo.toml for [workspace] section with members."

    # Python Ecosystem
    python_monorepo:
      detect_by:
        pattern: "Multiple pyproject.toml files in subdirectories"
      package_locations: "Each directory containing pyproject.toml"
      common_paths: ["packages/*", "libs/*", "services/*"]
      notes: "No standard monorepo tool. May use pants, bazel, or custom scripts."

    pants:
      detect_by:
        files: ["pants.toml", "pants.ini", "BUILD"]
      package_locations: "BUILD files define targets"
      common_paths: ["src/*", "packages/*"]
      notes: "Pants build system. Language-agnostic but common in Python shops."

    # JVM Ecosystem
    maven_multi_module:
      detect_by:
        files: ["pom.xml"]
        content_pattern: "<modules>"
      package_locations: "pom.xml → modules section"
      common_paths: ["modules/*", "apps/*", "libs/*"]
      notes: "Parent pom.xml with <modules> listing child projects."

    gradle_multi_project:
      detect_by:
        files: ["settings.gradle", "settings.gradle.kts"]
        content_pattern: "include"
      package_locations: "settings.gradle → include statements"
      common_paths: ["app/*", "lib/*", "modules/*", "subprojects/*"]
      notes: "settings.gradle with include(':module-name') statements."

    # General/Polyglot
    bazel:
      detect_by:
        files: ["WORKSPACE", "WORKSPACE.bazel", "MODULE.bazel"]
      package_locations: "BUILD or BUILD.bazel files"
      common_paths: ["src/*", "packages/*"]
      notes: "Google's build system. Language-agnostic. Modern uses MODULE.bazel (Bzlmod)."

    buck2:
      detect_by:
        files: [".buckconfig", "BUCK", "TARGETS"]
      package_locations: "BUCK or TARGETS files"
      common_paths: ["src/*", "packages/*"]
      notes: "Meta's build system. Similar to Bazel."

    # .NET Ecosystem
    dotnet_solution:
      detect_by:
        files: ["*.sln"]
        pattern: "Multiple *.csproj files"
      package_locations: "*.sln references or Directory.Build.props"
      common_paths: ["src/*", "tests/*", "libs/*"]
      notes: "Solution file (.sln) with multiple project references."

  # Scoping Strategy
  scoping_protocol: |
    When monorepo is detected, determine scope using this priority:

    1. WORKING DIRECTORY
       If user's current directory is inside a package, use that package.
       Example: cwd=/repo/packages/frontend → scope to packages/frontend

    2. EXPLICIT USER REQUEST
       If user mentions a package name or path, use that.
       Example: "Add tests for the API service" → find and scope to API service package

    3. FILE PATH CONTEXT
       If user references a specific file, scope to its containing package.
       Example: "Fix tests in src/api/user.test.ts" → scope to package containing that file

    4. ASK USER
       If scope is ambiguous, list packages and ask:
       "This is a [TYPE] monorepo. Which package should I work with?"
       - List packages with detected language/framework for each
       - Offer "All packages" option if task applies globally

  # Cross-Package Considerations
  cross_package_testing: |
    Some tests span multiple packages. Consider:

    1. SHARED TEST UTILITIES
       - Check for packages/test-utils, libs/testing, or similar
       - These may provide shared fixtures, mocks, or helpers
       - Import shared utilities rather than duplicating

    2. ROOT-LEVEL CONFIGS
       - Some configs live at root: playwright.config.ts, jest.config.base.js
       - Packages may extend root config: extends: '../../jest.config.base.js'
       - Check both package-level and root-level configs

    3. INTEGRATION TESTS
       - May test interaction between packages
       - Often in dedicated packages/e2e or tests/integration directory
       - May need to build multiple packages before testing

    4. CI CONSIDERATIONS
       - Package-specific: test only changed packages
       - Monorepo-wide: test all affected by changes
       - Use tools: nx affected, turborepo --filter, lerna changed

# =============================================================================
# FALLBACK CONFIGURATION
# =============================================================================

_fallback:
  description: |
    For languages not listed above, TEA will:
    1. Attempt detection from file extensions
    2. Web search for "[language] testing framework [CURRENT_YEAR]"
    3. Web search for "[language] official documentation"
    4. Ask user for guidance if uncertain
    5. Apply universal testing principles regardless of language

  # MANDATORY: Always fetch with current timestamp
  realtime_fetch_required: true
  fetch_with_timestamp: "NOW()"

  universal_principles:
    - "Given-When-Then structure for test readability"
    - "One assertion per test (atomic tests)"
    - "Test isolation - no shared mutable state"
    - "Auto-cleanup of created resources"
    - "Deterministic execution - no flaky tests"
    - "Risk-based prioritization (P0-P3)"
    - "Factory pattern for test data"
    - "Fixtures for reusable setup/teardown"

  # Web search patterns - ALWAYS include current year/date
  web_search_patterns:
    - "{language} testing framework {CURRENT_YEAR}"
    - "{language} test best practices {CURRENT_YEAR}"
    - "{language} official documentation"
    - "{framework} getting started guide {CURRENT_YEAR}"
    - "{framework} latest version"
    - "{framework} changelog {CURRENT_YEAR}"

# =============================================================================
# REAL-TIME FETCHING PROTOCOL
# =============================================================================

_realtime_protocol:
  description: |
    TEA MUST follow this protocol for EVERY code generation task.
    This ensures generated code is always current and accurate.

  mandatory_steps:
    1_before_generation: |
      BEFORE generating any test code, fixtures, or configuration:
      - Record current timestamp: fetch_time = NOW()
      - This timestamp MUST be included in all web searches
      - This timestamp MUST be included in generated code comments

    2_fetch_documentation: |
      Web fetch official documentation with current date context:
      - Search: "[framework] documentation" 
      - Search: "[framework] [CURRENT_YEAR] best practices"
      - Search: "[framework] v[detected_version] guide"
      - Verify URLs are accessible and current

    3_fetch_latest_changes: |
      Check for recent updates:
      - Search: "[framework] changelog [CURRENT_YEAR]"
      - Search: "[framework] breaking changes"
      - Search: "[framework] migration guide"
      - Note any deprecations or new recommendations

    4_generate_with_metadata: |
      Include in ALL generated code:
      ```
      // ============================================
      // Generated by TEA (Test Architect)
      // Timestamp: {NOW() in ISO 8601 format}
      // Language: {detected_language}
      // Framework: {framework} v{version}
      // Documentation sources:
      //   - {url_1} (fetched: {timestamp})
      //   - {url_2} (fetched: {timestamp})
      // ============================================
      ```

    5_never_use_cached: |
      CRITICAL: Never use memorized/cached patterns.
      - LLM training data has a cutoff date
      - Framework APIs change frequently
      - Always prefer freshly fetched documentation
      - If web fetch fails, clearly mark output as "[UNVERIFIED - WEB FETCH FAILED]"

  fetch_failure_handling: |
    If web fetch fails or times out:
    1. Retry with alternative search terms
    2. Try framework's GitHub repository directly
    3. If all fetches fail:
       - Use LLM knowledge as fallback
       - Mark output: "[FALLBACK - Could not fetch latest docs]"
       - Recommend user verify against official documentation
       - Include last known documentation URL for manual check

# =============================================================================
# METADATA
# =============================================================================

_meta:
  version: "1.3.0"
  last_updated: "2026-01-23"
  last_verified: "2026-01-23T00:00:00Z" # URLs verified via web fetch
  total_languages: 30
  monorepo_patterns: 15

  # Verified framework versions as of January 2026 (for reference only)
  # IMPORTANT: Always fetch latest docs - these versions will be outdated
  verified_versions:
    playwright: "latest (Node.js 20.x, 22.x, 24.x required)"
    vitest: "4.0.17 (Vite >=6.0.0, Node >=20.0.0 required)"
    jest: "30.0"
    pytest: "latest (Python 3.10+ required)"
    junit: "6.0.2 (Java 17+ required)"
    go_testing: "go1.25.6"
    cypress: "latest"

  purpose: |
    Detection hints for TEA language-agnostic testing.
    This file provides patterns to IDENTIFY languages and frameworks.

    CRITICAL: This file does NOT contain code templates or API details.
    All code generation MUST use real-time web fetch with NOW() timestamp.

  realtime_requirement: |
    TEA MUST fetch documentation from the internet at execution time.
    - Every workflow execution = fresh web fetch
    - Include current timestamp in searches (NOW())
    - Include fetch timestamp in generated code
    - Never rely on static examples in this file
    - Versions listed above are for REFERENCE ONLY - always fetch latest

  maintenance: |
    This file requires minimal maintenance because:
    1. Detection patterns (file extensions, package files) rarely change
    2. Code generation uses live web fetch, not static templates
    3. Unknown languages fall back to web search + LLM knowledge

    Update this file when:
    - New mainstream language emerges (detection patterns needed)
    - Framework detection pattern changes (e.g., new config file name)
    - Documentation URL structure changes significantly

    DO NOT update this file for:
    - API changes (handled by real-time fetch)
    - Best practice updates (handled by real-time fetch)
    - Version updates (handled by real-time fetch)

  url_verification_note: |
    URLs in this file were verified on 2026-01-23.
    However, URLs can change. If a URL fails:
    1. Web search for "[framework] official documentation"
    2. Check framework's GitHub repository
    3. Update this file with new URL if found
